// 將不同格式的資料，統一轉成本系統用的欄位
function normalizeRaceRecord(r) {
  // 距離：可能是數字，也可能是 "21 km" / "42.195 km"
  const distanceRaw =
    r.distanceKm ??
    r.distance ??
    r["距離"] ??
    "";

  let distanceKm = "";
  if (distanceRaw !== "" && distanceRaw != null) {
    if (typeof distanceRaw === "number") {
      distanceKm = distanceRaw;
    } else {
      const m = String(distanceRaw).match(/[\d.]+/);
      distanceKm = m ? Number(m[0]) : "";
    }
  }

  return {
    id:
      r.id ||
      (crypto.randomUUID
        ? crypto.randomUUID()
        : String(Date.now()) + Math.random().toString(16).slice(2)),

    // 參賽者
    participant: r.participant || r["參賽者"] || "",

    // 比賽名稱
    raceNameZh: r.raceNameZh || r["中文名稱"] || "",
    raceNameEn: r.raceNameEn || r["英文名稱"] || "",

    // 日期
    date: r.date || r["比賽日期"] || "",

    // 距離
    distanceKm,

    // Bib 號碼
    bibNumber: r.bibNumber || r.bib || r["參賽編號"] || "",

    // 起跑 / 完成時間
    startTime: r.startTime || r["起步時間"] || "",
    finishTime: r.finishTime || r.resultTime || r["完成時間"] || "",

    // 地點 / 主辦
    location: r.location || r["地點"] || "",
    organizer: r.organizer || r["主辦單位"] || "",

    // 備註
    notes: r.notes || r.remark || r["備註"] || ""
  };
}

importedRaces = importedRaces.map(normalizeRaceRecord);
